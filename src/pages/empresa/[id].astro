---
import Layout from "@layouts/Layout.astro";
import Header from "@components/Header.astro";
import SearchForm from "@components/SearchForm";
import Main from "@components/Main.astro";
import { supabase } from "@lib/supabase";
import PropertiesListByCompany from "@components/PropertiesListByCompany";

const { id } = Astro.params;
const { currentUserId: userId } = Astro.locals;

export async function getStaticPaths() {
  const { data, error } = await supabase.from("company").select("id");
  if (error) {
    console.error("Error fetching items:", error.message);
    return [];
  }
  return data.map((company) => ({
    params: { id: company.id.toString() },
  }));
}

const { data: company } = await supabase
  .from("company")
  .select("*")
  .eq("id", Astro.params.id)
  .single();

if (!id || !company) {
  return Astro.redirect("/404");
}
---

<Layout>
  <Header />
  <Main>
    <SearchForm client:load />
    <div class="mb-6">
      <a href={`/empresa/${id}`} title={company.name} class="inline-block">
        <img
          src={company.logo_url}
          width="300px"
          class="mb-4"
          alt={company.name}
        />
      </a>
      <h1 class="text-3xl font-semibold mb-4">
        {company.name}
      </h1>
      <p class="text-lg">{company.description}</p>
    </div>
    <div class="mb-20">
      <button
        class="text-lg px-6 py-3 bg-black text-white rounded-full transition-colors duration-700 hover:bg-gray-800 active:bg-gray-900"
      >
        Contactar
      </button>
    </div>
    <PropertiesListByCompany
      client:load
      userId={userId}
      companyId={company.id}
    />
  </Main>
</Layout>
